<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>گزارش کار پایان نامه - مصطفی شهبازی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f9fafb; /* Tailwind gray-50 */
            display: flex;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .sidebar {
            width: 250px;
            min-width: 250px; /* Prevent sidebar from shrinking too much */
            background-color: #1f2937; /* Tailwind gray-800 */
            color: white;
            padding: 1.5rem; /* Tailwind p-6 */
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            overflow-y: auto;
            transition: transform 0.3s ease-in-out;
            z-index: 1000; /* Ensure sidebar is above content */
        }
        .sidebar h3 {
            font-size: 1.25rem; /* Tailwind text-xl */
            font-weight: 700; /* Tailwind font-bold */
            margin-bottom: 1.5rem; /* Tailwind mb-6 */
            border-bottom: 1px solid #4b5563; /* Tailwind gray-600 */
            padding-bottom: 0.75rem; /* Tailwind pb-3 */
        }
        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }
        .sidebar li a {
            display: block;
            color: #d1d5db; /* Tailwind gray-300 */
            padding: 0.75rem 1rem; /* Tailwind py-3 px-4 */
            border-radius: 0.375rem; /* Tailwind rounded-md */
            transition: background-color 0.2s ease, color 0.2s ease;
            text-decoration: none;
        }
        .sidebar li a:hover, .sidebar li a.active {
            background-color: #3b82f6; /* Tailwind blue-500 */
            color: white;
        }
        .main-content-wrapper { /* New wrapper for main content */
            flex-grow: 1;
            padding-right: 250px; /* Space for the sidebar */
            transition: padding-right 0.3s ease-in-out;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            padding: 1.5rem; /* Tailwind p-6 */
            max-width: 900px; /* Increased max-width slightly */
            margin-left: auto;
            margin-right: auto;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; /* Tailwind rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Tailwind shadow-lg */
            padding: 1.5rem; /* Tailwind p-6 */
            margin-bottom: 1.5rem; /* Tailwind mb-6 */
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .header-title { /* Class for the main h1 title */
            font-size: 2.25rem; /* Tailwind text-4xl */
            line-height: 2.5rem; /* Tailwind leading-10 */
        }
        .card h2 {
            font-size: 1.5rem; /* Tailwind text-2xl */
            font-weight: 700; /* Tailwind font-bold */
            color: #1f2937; /* Tailwind gray-800 */
            margin-bottom: 1rem; /* Tailwind mb-4 */
            border-bottom: 2px solid #60a5fa; /* Tailwind blue-400 */
            padding-bottom: 0.5rem; /* Tailwind pb-2 */
        }
        .card h3 {
            font-size: 1.25rem; /* Tailwind text-xl */
            font-weight: 600; /* Tailwind font-semibold */
            color: #374151; /* Tailwind gray-700 */
            margin-top: 1rem; /* Tailwind mt-4 */
            margin-bottom: 0.5rem; /* Tailwind mb-2 */
        }
        .card p, .card ul {
            color: #4b5563; /* Tailwind gray-600 */
            line-height: 1.75; /* Tailwind leading-relaxed */
        }
        .card ul {
            list-style-type: disc;
            padding-right: 1.5rem; /* Tailwind pr-6, equivalent to pl for LTR */
        }
        .step-update-info { /* Class for step update date */
            font-size: 0.75rem; /* Tailwind text-xs */
            color: #6b7280; /* Tailwind gray-500 */
            margin-top: 0.75rem; /* Tailwind mt-3 */
        }
        .tag {
            display: inline-block;
            background-color: #dbeafe; /* Tailwind blue-100 */
            color: #1e40af; /* Tailwind blue-800 */
            padding: 0.25rem 0.75rem; /* Tailwind px-3 py-1 */
            border-radius: 9999px; /* Tailwind rounded-full */
            font-size: 0.875rem; /* Tailwind text-sm */
            font-weight: 500; /* Tailwind font-medium */
            margin-right: 0.5rem; /* Tailwind mr-2 */
            margin-bottom: 0.5rem; /* Tailwind mb-2 */
        }
        .status {
            font-weight: bold;
        }
        .status-current {
            color: #2563eb; /* Tailwind blue-600 */
        }
        .status-planned {
            color: #f59e0b; /* Tailwind amber-500 */
        }
        .status-completed {
            color: #16a34a; /* Tailwind green-600 */
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb; /* Tailwind gray-200 */
            border-radius: 0.5rem; /* Tailwind rounded-lg */
            overflow: hidden;
            margin-top: 0.5rem; /* Tailwind mt-2 */
        }
        .progress-bar {
            height: 1.25rem; /* Tailwind h-5 */
            background-color: #3b82f6; /* Tailwind blue-500 */
            text-align: center;
            color: white;
            font-weight: bold;
            line-height: 1.25rem; /* Tailwind leading-5 */
            transition: width 0.5s ease-in-out;
        }
        .author-info {
            background-color: #e0f2fe; /* Tailwind light blue - sky-100 */
            border: 1px solid #7dd3fc; /* Tailwind sky-300 */
            padding: 1rem; /* Tailwind p-4 */
            border-radius: 0.5rem; /* Tailwind rounded-lg */
            margin-bottom: 2rem; /* Tailwind mb-8 */
        }
        .author-info p {
            margin-bottom: 0.5rem; /* Tailwind mb-2 */
            color: #0c4a6e; /* Tailwind sky-800 */
        }
        .author-info strong {
            color: #0369a1; /* Tailwind sky-700 */
        }
        .menu-toggle {
            display: none; /* Hidden by default, shown in media query */
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1100; /* Above sidebar when it's closed */
            background-color: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            border: none;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%); /* Hide sidebar by default for RTL */
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content-wrapper {
                padding-right: 0; /* Main content takes full width */
            }
            .main-content {
                padding: 1rem; /* Tailwind p-4 for smaller screens */
            }
            .menu-toggle {
                display: block;
            }
            .header-title { /* Adjust main title size */
                font-size: 1.875rem; /* Tailwind text-3xl */
                line-height: 2.25rem; /* Tailwind leading-9 */
            }
            .card h2 { /* Adjust card title size */
                font-size: 1.25rem; /* Tailwind text-xl */
            }
            .card h3 { /* Adjust card subtitle size */
                font-size: 1.125rem; /* Tailwind text-lg */
            }
            .author-info {
                padding: 0.75rem; /* Tailwind p-3 */
            }
            .author-info h3 {
                font-size: 1.125rem; /* Tailwind text-lg */
            }
            .step-update-info {
                font-size: 0.65rem; /* Tailwind text-xs adjusted for mobile */
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <div class="sidebar" id="sidebar">
        <h3>فهرست گام‌ها</h3>
        <ul id="sidebarNav">
            </ul>
    </div>

    <button class="menu-toggle" id="menuToggle">☰ فهرست</button>

    <div class="main-content-wrapper" id="mainContentWrapper">
        <div class="main-content">
            <header class="text-center mb-10">
                <h1 class="header-title font-bold text-blue-600">گزارش پیشرفت پروژه: پیاده‌سازی و توسعه DiffiT</h1>
                <p class="text-lg text-gray-700 mt-2">
                    این گزارش به منظور بررسی مراحل پیاده‌سازی و بهبودهای پیشنهادی برای مقاله
                    <a href="https://arxiv.org/abs/2312.02139" target="_blank" class="text-blue-500 hover:underline">
                    "DiffiT: Diffusion Vision Transformers for Image Generation"
                    </a>
                    تهیه شده است.
                </p>
            </header>

            <div class="author-info">
                <h3 class="text-xl font-semibold text-sky-700 mb-3">اطلاعات دانشجو:</h3>
                <p><strong>نام و نام خانوادگی:</strong> مصطفی شهبازی</p>
                <p><strong>شماره دانشجویی:</strong> - </p>
                <p><strong>دانشگاه:</strong> دانگشاه تربیت مدرس - دانشکده علوم ریاضی</p>
                <p><strong>استاد راهنما:</strong> دکتر رزقی </p>
            </div>

            <main id="progressReport">
                <div class="card" id="step-1">
                    <h2>گام اول: پیاده‌سازی کد مقاله (Image Space)</h2>
                    <p><span class="tag">وضعیت</span> <span class="status status-current">فعلی</span></p>
                    <h3>شرح فعالیت:</h3>
                    <p>
                        در این گام، تمرکز بر پیاده‌سازی بخش اصلی مقاله یعنی مدل DiffiT برای تولید تصویر در فضای نهان (Latent Space) است.
                        این بخش شامل موارد زیر می‌باشد:
                    </p>
                    <ul>
                        <li>پیاده‌سازی معماری Vision Transformer (ViT) به عنوان پایه مدل.</li>
                        <li>پیاده‌سازی مکانیزم Time-dependant Multihead Self Attention (TMSA) برای کنترل فرآیند Denoising.</li>
                        <li>آموزش مدل بر روی دیتاست ImageNet-256 طبق توضیحات مقاله.</li>
                        <li>باز تولید نتایج مربوط به FID score گزارش شده در مقاله (هدف: FID=1.73).</li>
                        <li>بررسی و تحلیل پارامترهای مدل و مقایسه با مدل‌های DiT و MDT.</li>
                    </ul>
                    <h3>اهداف:</h3>
                    <ul>
                        <li>دستیابی به درک عمیق از معماری DiffiT و مکانیزم TMSA.</li>
                        <li>توانایی بازتولید نتایج اصلی مقاله در محیط کنترل‌شده.</li>
                        <li>ایجاد یک پایه‌کد (Baseline) قوی برای گام‌های بعدی توسعه.</li>
                    </ul>
                    <h3>چالش‌های پیش‌بینی شده:</h3>
                    <ul>
                        <li>نیاز به منابع محاسباتی قابل توجه برای آموزش مدل روی ImageNet.</li>
                        <li>پیچیدگی‌های احتمالی در پیاده‌سازی دقیق مکانیزم TMSA.</li>
                        <li>تطبیق دقیق Hyperparameter ها برای رسیدن به نتایج مشابه مقاله.</li>
                    </ul>
                    <p class="step-update-info">آخرین بروزرسانی گام: <span class="step-update-date">۱۰ خرداد ۱۴۰۴، ساعت ۱۵:۳۰</span></p>
                    <h3>پیشرفت:</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 60%;">60%</div>
                    </div>
                </div>

                <div class="card" id="step-2">
                    <h2>گام دوم: تطبیق معماری مقاله با روش های fine-tuning </h2>
                    <p><span class="tag">وضعیت</span> <span class="status status-planned">برنامه‌ریزی شده</span></p>
                    <h3>شرح فعالیت:</h3>
                    <p>
                        پس از پیاده‌سازی موفقیت‌آمیز مدل پایه، در این گام به بررسی و پیاده‌سازی روش‌های بهینه‌سازی و کاهش پارامتر برای مدل DiffiT با استفاده از تکنیک‌های Low-Rank Adaptation (LoRA) و Quantized LoRA (QLoRA) پرداخته خواهد شد.
                    </p>
                    <ul>
                        <li>مطالعه و بررسی نحوه ادغام LoRA با معماری مبتنی بر Transformer مدل DiffiT.</li>
                        <li>پیاده‌سازی LoRA برای لایه‌های Attention و MLP در بلوک‌های DiffiT.</li>
                        <li>بررسی تاثیر استفاده از QLoRA برای کاهش بیشتر حافظه و افزایش سرعت Inference بدون افت قابل توجه کیفیت.</li>
                        <li>مقایسه عملکرد (FID score، تعداد پارامترها، سرعت آموزش و Inference) مدل‌های مجهز به LoRA/QLoRA با مدل پایه.</li>
                        <li>آزمایش بر روی دیتاست‌های ImageNet-256 و احتمالاً دیتاست‌های دیگر برای ارزیابی عمومیت روش.</li>
                    </ul>
                    <h3>اهداف:</h3>
                    <ul>
                        <li>کاهش چشمگیر تعداد پارامترهای قابل آموزش مدل DiffiT.</li>
                        <li>امکان Fine-tuning سریع‌تر و با منابع کمتر برای وظایف خاص.</li>
                        <li>بررسی توازن بین کاهش پارامتر و حفظ کیفیت تولید تصویر.</li>
                    </ul>
                    <h3>چالش‌های پیش‌بینی شده:</h3>
                    <ul>
                        <li>انتخاب بهینه رنک (rank) برای ماتریس‌های LoRA.</li>
                        <li>تنظیمات مربوط به کوانتیزه‌سازی در QLoRA و تاثیر آن بر پایداری آموزش.</li>
                        <li>اطمینان از اینکه تغییرات اعمال شده، ویژگی‌های اصلی مکانیزم TMSA را مختل نمی‌کند.</li>
                    </ul>
                    <h3>منابع</h3>
                    <ul>
                        <li>
                            <a href="https://gautam75.medium.com/exploring-different-lora-variants-for-efficient-llm-fine-tuning-4ca41179e658" target="_blank" class="text-blue-500 hover:underline">
                                Exploring different LoRA variants for efficient LLM Fine-Tuning
                            </a>
                        </li>
                    </ul>
                    <p class="step-update-info">آخرین بروزرسانی گام: <span class="step-update-date">۰۵ خرداد ۱۴۰۴، ساعت ۱۰:۰۰</span></p>
                    <h3>پیشرفت:</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;">0%</div>
                    </div>
                </div>

                <!--
                <div class="card" id="step-3">
                    <h2>گام سوم: [عنوان گام سوم]</h2>
                    <p><span class="tag">وضعیت</span> <span class="status status-planned">برنامه‌ریزی شده</span></p>
                    <h3>شرح فعالیت:</h3>
                    <p>[توضیحات گام سوم]</p>
                    <ul>
                        <li>[مورد ۱]</li>
                        <li>[مورد ۲]</li>
                    </ul>
                    <p class="step-update-info">آخرین بروزرسانی گام: <span class="step-update-date">تاریخ اولیه</span></p>
                    <h3>پیشرفت:</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;">0%</div>
                    </div>
                </div>
                -->
            </main>

            <footer class="text-center mt-12 py-6 border-t border-gray-300">
                <p class="text-gray-600 text-sm">
                    آخرین بروزرسانی کلی گزارش: <span id="overallLastUpdated"></span>
                </p>
            </footer>
        </div>
    </div>

    <script>
        // Function to update the progress of a step and its last updated date
        function updateStep(stepId, percentage, dateString) {
            const stepElement = document.getElementById(stepId);
            if (stepElement) {
                const progressBar = stepElement.querySelector('.progress-bar');
                if (progressBar) {
                    progressBar.style.width = percentage + '%';
                    progressBar.textContent = percentage + '%';
                }
                const dateSpan = stepElement.querySelector('.step-update-date');
                if (dateSpan) {
                    if (dateString) {
                        dateSpan.textContent = dateString;
                    } else { // Auto-update with current date and time if no dateString is provided
                        dateSpan.textContent = new Date().toLocaleDateString('fa-IR', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                }
            }
        }
        
        // Example call: updateStep('step-1', 70); // Updates progress and sets step's date to now
        // Example call: updateStep('step-2', 10, '۱۲ خرداد ۱۴۰۴، ساعت ۱۱:۰۰'); // Updates progress and sets specific date


        // Set overall last updated date for the report
        document.getElementById('overallLastUpdated').textContent = new Date().toLocaleDateString('fa-IR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        // Sidebar navigation and population
        document.addEventListener('DOMContentLoaded', function () {
            const reportContainer = document.getElementById('progressReport');
            const sidebarNav = document.getElementById('sidebarNav');
            const steps = reportContainer.querySelectorAll('.card');
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menuToggle');
            const mainContentWrapper = document.getElementById('mainContentWrapper');


            steps.forEach(step => {
                const stepTitle = step.querySelector('h2').textContent;
                const stepId = step.id;
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `#${stepId}`;
                link.textContent = stepTitle;
                link.onclick = function(e) {
                    e.preventDefault();
                    const targetElement = document.getElementById(stepId);
                    if (targetElement) {
                        mainContentWrapper.scrollTo({
                            top: targetElement.offsetTop - mainContentWrapper.offsetTop - 20, 
                            behavior: 'smooth'
                        });
                    }

                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('open');
                    }
                    sidebarNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
                    link.classList.add('active');
                };
                listItem.appendChild(link);
                sidebarNav.appendChild(listItem);
            });

            if (sidebarNav.firstChild && sidebarNav.firstChild.firstChild) {
                 sidebarNav.firstChild.firstChild.classList.add('active');
            }

            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                });
            }

            mainContentWrapper.addEventListener('scroll', function() {
                let current = '';
                let minDistance = Infinity;

                steps.forEach(step => {
                    const stepElement = document.getElementById(step.id);
                    if (stepElement) {
                        const rect = stepElement.getBoundingClientRect();
                        const distanceToTop = Math.abs(rect.top - mainContentWrapper.getBoundingClientRect().top);

                        if (rect.top <= (mainContentWrapper.getBoundingClientRect().top + 150) && rect.bottom >= mainContentWrapper.getBoundingClientRect().top) {
                           if (distanceToTop < minDistance) {
                               minDistance = distanceToTop;
                               current = step.id;
                           }
                        }
                    }
                });

                sidebarNav.querySelectorAll('a').forEach(a => {
                    a.classList.remove('active');
                    if (a.getAttribute('href') === `#${current}`) {
                        a.classList.add('active');
                    }
                });
                if (!current && sidebarNav.firstChild && sidebarNav.firstChild.firstChild && mainContentWrapper.scrollTop < 100) {
                    // sidebarNav.firstChild.firstChild.classList.add('active'); // Optionally keep first active if scrolled to top
                }
            });
             // Initialize progress for existing steps (if needed, or set initial dates in HTML)
            // updateStep('step-1', 60); // This will also update its date to now
        });

        // Function to dynamically add new steps (if you implement this feature)
        // function addStep(title, description, tasks = [], status = 'برنامه‌ریزی شده', progress = 0, initialDate = 'تاریخ اولیه') {
        //     const mainContent = document.getElementById('progressReport');
        //     const stepCount = mainContent.querySelectorAll('.card').length + 1;
        //     const newStepId = `step-${stepCount}`;

        //     let taskListHTML = '';
        //     if (tasks.length > 0) {
        //         taskListHTML = '<ul>' + tasks.map(task => `<li>${task}</li>`).join('') + '</ul>';
        //     }
            
        //     const statusClass = status === 'فعلی' ? 'status-current' : status === 'تکمیل شده' ? 'status-completed' : 'status-planned';

        //     const newStepHTML = `
        //         <div class="card" id="${newStepId}">
        //             <h2>گام ${stepCount}: ${title}</h2>
        //             <p><span class="tag">وضعیت</span> <span class="status ${statusClass}">${status}</span></p>
        //             <h3>شرح فعالیت:</h3>
        //             <p>${description}</p>
        //             ${taskListHTML}
        //             <p class="step-update-info">آخرین بروزرسانی گام: <span class="step-update-date">${initialDate}</span></p>
        //             <h3>پیشرفت:</h3>
        //             <div class="progress-bar-container">
        //                 <div class="progress-bar" style="width: ${progress}%;">${progress}%</div>
        //             </div>
        //         </div>
        //     `;
        //     mainContent.insertAdjacentHTML('beforeend', newStepHTML);

        //     // Add to sidebar
        //     const sidebarNav = document.getElementById('sidebarNav');
        //     const listItem = document.createElement('li');
        //     const link = document.createElement('a');
        //     link.href = `#${newStepId}`;
        //     link.textContent = `گام ${stepCount}: ${title}`;
        //     link.onclick = function(e) { /* ... (same click handler as above) ... */ };
        //     listItem.appendChild(link);
        //     sidebarNav.appendChild(listItem);
        // }
    </script>
</body>
</html>
